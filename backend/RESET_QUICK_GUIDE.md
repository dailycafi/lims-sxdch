# 测试阶段数据库重置 - 快速参考

## ✅ 是的，完全可以重置！

在测试阶段，您可以随时使用 `init_db.py --drop` 重置数据库的**结构和内容**。

## 🚀 一键重置（推荐）

### Mac/Linux
```bash
cd backend
./reset_db.sh
```

### Windows
```bash
cd backend
reset_db.bat
```

**执行时间**: 5-10秒  
**效果**: 完全重置到干净状态

---

## 📋 重置内容清单

### ✅ 会被删除并重建
- 所有数据库表（包括新的角色权限表）
- 所有用户数据（会重新创建6个测试用户）
- 所有项目和样本数据（会重新创建测试数据）
- 所有角色和权限配置（会重新创建7个角色和35个权限）
- 所有审计日志和操作记录

### ✅ 重置后自动创建
- **6个测试用户** - admin, sample_admin, project_lead, test_manager, lab_director, analyst
- **7个系统角色** - 系统管理员、样本管理员、项目负责人等
- **35个权限** - 覆盖用户、角色、样本、项目等9个模块
- **测试数据** - 组织、样本类型、存储设备、项目、样本等

---

## 🔧 手动分步重置（高级）

如果需要更精细的控制：

```bash
cd backend

# 步骤1: 重建所有表和基础数据
python init_db.py --drop

# 步骤2: 初始化角色权限（7个角色，35个权限）
python init_roles.py

# 步骤3: 为用户分配角色
python migrate_user_roles.py
```

---

## 📊 重置后的状态

| 项目 | 数量 | 说明 |
|------|------|------|
| 数据库表 | ~20个 | 包含用户、角色、权限、样本、项目等 |
| 测试用户 | 6个 | 每个用户对应不同角色 |
| 系统角色 | 7个 | 预定义的角色配置 |
| 权限条目 | 35个 | 覆盖9个功能模块 |
| 测试项目 | 若干 | 用于测试的项目数据 |
| 测试样本 | 若干 | 用于测试的样本数据 |

---

## 🎯 常见使用场景

### 1️⃣ 每天开始测试前
```bash
./reset_db.sh  # 获得干净的测试环境
```

### 2️⃣ 测试数据混乱了
```bash
./reset_db.sh  # 快速恢复
```

### 3️⃣ 修改了数据库模型
```bash
./reset_db.sh  # 重建表结构
```

### 4️⃣ 更新了角色权限配置
```bash
# 1. 修改 init_roles.py
# 2. 运行重置
./reset_db.sh
```

---

## ⚡ 快速命令对照表

| 场景 | 命令 | 说明 |
|------|------|------|
| 完整重置 | `./reset_db.sh` | 推荐 ⭐ |
| 重建数据库 | `python init_db.py --drop` | 删除所有表 |
| 更新角色权限 | `python init_roles.py` | 不删除其他数据 |
| 重新分配用户角色 | `python migrate_user_roles.py` | 基于现有用户 |

---

## 💡 测试建议

重置后建议测试的功能：

- ✅ 使用不同角色登录（6个测试账号）
- ✅ 创建新用户（测试密码验证）
- ✅ 分配多个角色给用户
- ✅ 创建自定义角色
- ✅ 编辑角色权限配置
- ✅ 测试权限控制

---

## ⚠️ 重要提示

### 测试阶段 ✅
- **随意重置** - 不用担心数据丢失
- **快速迭代** - 遇到问题就重置
- **实验功能** - 大胆尝试各种配置

### 生产环境 ⛔
- **不要使用** `init_db.py --drop`
- **使用迁移工具** - 如 Alembic
- **先备份数据** - 再做任何变更
- **版本管理** - 追踪所有数据库变更

---

## 📝 测试账号信息

| 用户名 | 默认角色 | 用途 |
|--------|---------|------|
| admin | 系统管理员 | 测试所有功能 |
| sample_admin | 样本管理员 | 测试样本管理 |
| project_lead | 项目负责人 | 测试项目功能 |
| test_manager | 分析测试主管 | 测试测试管理 |
| lab_director | 研究室主任 | 测试查看和审批 |
| analyst | 分析测试员 | 测试基本功能 |

*密码请查看 `init_db.py` 文件*

---

## 🆘 遇到问题？

1. **重置失败** → 检查数据库连接配置
2. **服务报错** → 重启后端服务
3. **权限不对** → 再次运行 `./reset_db.sh`
4. **数据异常** → 完整重置解决

---

**记住**: 测试阶段，随时可以重置！不用担心！🎉

